# Story 4.1: Hear Spoken Description of Scene Analysis

## Status: Approved

## Story

-   As an AI Enthusiast,
-   after Sourcer analyzes the scene,
-   I want to hear a spoken description of what it sees so that I can receive information hands-free.

## Acceptance Criteria (ACs)

1.  The textual description generated by the `VisionService` (and available to the `CoreOrchestrator` as per Story 3.1) is successfully passed to the local `TTSService` (integrating Piper TTS via Pipecat).
2.  The `TTSService` (using Pipecat and a local Piper TTS model) generates audible speech from the provided textual description.
3.  The generated spoken response is played back clearly through the user's default system audio output device.
4.  TTS processing latency is minimized to ensure it contributes effectively to the overall sub-3-second voice interaction NFR.
5.  If the `TTSService` or Pipecat encounters an error during speech generation or playback (e.g., TTS model failure, audio device issue), the error is logged, and the application continues to function (i.e., the textual response is still available in the UI).

## Tasks / Subtasks

-   [ ] **Task 1: Implement `TTSService` using Pipecat (AC: 1, 2, 4)**
    -   [ ] Create/Update `src/sourcer/services/tts_service.py`.
    -   [ ] Define a `TTSService` class to manage Pipecat integration for Text-to-Speech.
    -   [ ] Configure Pipecat to use a local TTS transport (e.g., Piper TTS, as specified in the Architecture Document). Ensure the Piper TTS model is downloaded/accessible (refer to Story 1.0 and `scripts/download_models.py`).
    -   [ ] Implement a method in `TTSService` (e.g., `speak_text(text_to_speak: str)`):
        -   [ ] This method will use Pipecat's capabilities to send the `text_to_speak` to the configured local Piper TTS engine.
        -   [ ] Pipecat will handle the audio generation and playback through the default system audio output.
    -   [ ] Implement Pipecat event handlers within `TTSService` if needed for status updates or error handling related to TTS processing (e.g., `on_tts_start`, `on_tts_end`, `on_error`).
    -   [ ] Define Qt signals in `TTSService` (or use callbacks) if detailed status updates (beyond just playing audio) need to be communicated to `CoreOrchestrator` or UI (though likely not needed for basic playback).
-   [ ] **Task 2: Integrate `TTSService` with `CoreOrchestrator` (AC: 1, 3)**
    -   [ ] In `src/sourcer/core/orchestrator.py`:
        -   [ ] Instantiate `TTSService`.
        -   [ ] After receiving the textual description from `VisionService` (as per Story 3.1), the `CoreOrchestrator` calls `TTSService.speak_text(description)`.
-   [ ] **Task 3: Implement Basic Error Handling for TTS (AC: 5)**
    -   [ ] Ensure `TTSService` and `CoreOrchestrator` can gracefully handle errors from the TTS pipeline (e.g., Pipecat reports TTS failure, model not found, audio device unavailable).
    -   [ ] Log errors using the `logging` module.
    -   [ ] Ensure that a TTS failure does not crash the application and that the textual version of the response is still available in the UI (as per Story 4.2, which handles UI display).

## Dev Technical Guidance

-   **Pipecat for TTS:** The primary focus is integrating Pipecat for TTS output using the selected local Piper TTS model. This involves configuring Pipecat correctly and using its API to send text for synthesis and playback. Refer to Pipecat documentation for details.
-   **Asynchronous Operation:** TTS generation and playback can be asynchronous. Ensure that the call from `CoreOrchestrator` to `TTSService.speak_text()` does not block the main application loop or UI thread. Pipecat's architecture should facilitate this; the `TTSService` acts as an interface.
-   **Audio Output:** Pipecat should handle playback to the default system audio output. No direct PyQt audio code should be necessary in `TTSService` for basic playback.
-   **Error Handling:** If Pipecat or Piper TTS fails, the application shouldn't crash. The primary mode of information delivery (text in UI) must remain functional. Log TTS errors for debugging.
-   **Configuration:** The `TTSService` should load TTS model configurations (e.g., path to Piper TTS model) from `config/settings.ini` if needed, via the `ConfigLoader`.
-   **No New UI:** This story focuses purely on the auditory output. UI elements for displaying the text are covered in other stories (specifically Story 4.2 / PRD Story 7).

## Story Progress Notes

### Agent Model Used: `<Agent Model Name/Version>`

### Completion Notes List
{Any notes about implementation choices, difficulties, or follow-up needed}

### Change Log